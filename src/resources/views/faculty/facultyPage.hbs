<div class="page-container">
    <!-- Content Wrapper START -->
    <div class="main-content">
        <div class="container-fluid">
            <!-- Breadcrumb Start -->
            <div class="row">
                <!-- POST -->

                <!--  Post -->
                <div class="col-md-8" id="new-feed">
                    <!-- Create Post -->
                    <div class="card">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">
                                <div class="d-flex flex-row">
                                    <img class="avatar" src="/{{user.avatar}}" alt="">
                                    <input readonly data-toggle="modal" data-target="#modal-post"
                                        class="ml-2 form-control mt-1 post-box text-left"
                                        placeholder="Bạn đang nghĩ gì ?">
                                </div>
                                <hr class="mt-2 mb-2" style=" border-top: 1px solid rgb(214, 212, 212);">
                                <div class="d-flex flex-row  justify-content-center ">

                                    <label class="mb-0 btn btn-light col-md-5 custom-input mr-1" for="upload-photo"><i
                                            class="far fa-images"></i> Ảnh </label>
                            
                                    <label class="mb-0 btn btn-light col-md-5 custom-input ml-1" for="upload-video"><i
                                            class="fab fa-youtube"></i> Video</label>
                                   
                                </div>


                            </li>
                        </ul>
                    </div>
                    
                <!-- End Post -->
                <!-- Announce -->
                <div class="col-md-4">

                </div>
                <!--End  Announce -->
            </div>
            <!-- Breadcrumb End -->
        </div>


    </div>
    <!-- Content Wrapper END -->

    <!-- Footer START -->
    

</div>


<!-- Modal  Post-->
<div class="modal fade" id="modal-post" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content ">
            <div class="modal-header">
                <h3 class="modal-title" id="exampleModalLongTitle">Tạo bài viết</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <img class="avatar" src="/{{user.avatar}}" alt="">
                <div class="pl-2 d-flex flex-column">
                    <p class="avatar-name"> {{user.fullname}}</p>
                    <div class="badge badge-light col-md-2 col-2"><i class="fas fa-globe-asia"></i> Công khai <i
                            class="fas fa-caret-down"></i></div>
                </div>
                <form method="POST" id="form-add-post">
                    <textarea name="caption" id="post-caption" placeholder="Bạn đang nghĩ gì thế ? " type="text"
                        style="border: none; border-width: 0; box-shadow: none;font-size:17px" class="mt-1 form-control"></textarea>
                    <div class="img-post-field">
                        <div class="edit-post-field">
                            <div class=" d-flex flex-row">
                                <button class="btn btn-light edit-img-post mt-4 ml-4 "> <i class="fas fa-folder-plus"></i>
                                    Thêm ảnh</button>
                                <i class="far fa-times-circle float-right remove-img-post mr-3 mt-4"></i>
                            </div>

                        </div>


                        {{!-- <img src="img/dark-souls.jpg" class=" float-right form-control " style="height: auto;"> --}}

                    </div>
                    <input type="file" name="video" id="upload-video">
                    <input type="file" name="image" accept="image/x-png,image/gif,image/jpeg" multiple id="upload-photo">
                    <div class="add-to-post mt-3">
                        {{#if (and user.thematic 'all')}}
                            <select class="form-control form-control-sm checkbox-select-all-options ml-2 p-0 float-left" id="exampleFormControlSelect1" name="thematic" required>
                                <option value="all">-- Tất cả các mục --</option>
                                <option value="cthssv">-- Phòng CTHSSV --</option>
                                <option value="daihoc">-- Phòng Đại học --</option>
                                <option value="saudaihoc">-- Phòng Sau đại học --</option>
                                <option value="dientoanvamaytinh">-- Phòng Điện toán và máy tính--</option>
                                <option value="khaothikiemdinh">-- Phòng Khảo thí và kiểm định chất lượng --</option>
                                <option value="taichinh">-- Phòng tài chính --</option>
                                <option value="CLC">-- TDT Creative Language Center --</option>
                                <option value="tinhoc">-- Trung tâm tin học --</option>
                                <option value="phattrienxahoi">-- Trung tâm đào tạo phát triển xã hội (SDTC) --</option>
                                <option value="quanlyungdungcongnghe">-- Trung tâm phát triển Khoa học quản lý và Ứng dụng công nghệ (ATEM) --</option>
                                <option value="doanhnghiepcuusinhvien">-- Trung tâm hợp tác doanh nghiệp và cựu sinh viên --</option>
                                <option value="luat">-- Khoa luật --</option>
                                <option value="ngoaingutinhoc">-- Trung tâm ngoại ngữ - tin học – bồi dưỡng văn hóa --</option>
                                <option value="chinhsachkinhte">-- Viện chính sách kinh tế và kinh doanh --</option>
                                <option value="mtcn">-- Khoa Mỹ thuật công nghiệp --</option>
                                <option value="ddt">-- Khoa Điện – Điện tử --</option>
                                <option value="cntt">-- Khoa Công nghệ thông tin --</option>
                                <option value="qtkd">-- Khoa Quản trị kinh doanh --</option>
                                <option value="mtbvld">-- Khoa Môi trường và bảo hộ lao động --</option>
                                <option value="ldcd">-- Khoa Lao động công đoàn --</option>
                                <option value="tcnh">-- Khoa Tài chính ngân hàng --</option>
                                <option value="gdqt">-- Khoa giáo dục quốc tế --</option>
                            </select>
                        {{else}}
                            <select disabled class="form-control form-control-sm checkbox-select-all-options ml-2 p-0 float-left" id="exampleFormControlSelect1" name="thematic" required>
                                <option value="{{user.thematic}}">-- {{user.faculty}} --</option>
                            </select>
                        {{/if}}
                        <button type="button" class="btn btn-light btn-circle float-right" data-toggle="tooltip"
                            data-placement="top" title="Nhiều hơn"> <i class="fas fa-ellipsis-h"></i> </button>
                        <button type="button" class="btn btn-light btn-circle float-right" data-toggle="tooltip"
                            data-placement="top" title="Thêm video"> <i class="fab fa-youtube text-danger"></i> </button>
                        <button type="button" class="btn btn-light btn-circle float-right edit-img-post" data-toggle="tooltip"
                            data-placement="top" title="Thêm ảnh"> <i class="fas fa-image text-success"></i> </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                <button type="button" data-id="{{user._id}}" id="luan-btn" form="form-add-post" class="btn btn-primary">Đăng</button>
            </div>
        </div>
    </div>
</div>
<!-- End Modal  Post-->


<script>
    $(document).ready(function() {
        getPosts();

        console.log()
    });

    document.addEventListener('DOMContentLoaded', () => {
        let button = document.getElementById('luan-btn');
        let id = button.getAttribute('data-id');
        const URL = `http://localhost:8080/post/${id}`;
        button.onclick = (event) => {
            var caption = document.getElementById('post-caption').value;
            var imageFile = document.getElementById('upload-photo').files;
            var video = document.getElementById('upload-video').value;
            var thematic = document.getElementById('exampleFormControlSelect1').value;

            var formData = new FormData();
            formData.append('caption', caption);
            formData.append('image', imageFile[0]);
            formData.append('video', video);
            formData.append('thematic', thematic);
            formData.append('userID', id);

            $.ajax({
                url: URL,
                method: "POST",
                data: formData,
                cache: false,
                contentType: false,
                processData: false,
                success: function (data) {
                    alert(data.message);
                    getPosts();
                }
            });
        } 
    });

    function getPosts() {
        const URL = `http://localhost:8080/post/api`;
        $.ajax({
            url: URL,
            method: "GET",
            dataType: "json",
            success: function (data) {
                console.log(data)
                renderPost(data)
            }
        })
    }
    
    function renderPost(posts) {
        let html = '';
        let button = document.getElementById('luan-btn');
        let id = button.getAttribute('data-id');

        $.each(posts, function(index, post) {
            if (post.userID === id) {
                html += `<div class="card mt-1 luan-card">`
                    html +=`<div class="card-header pb-0">`
                        html +=`<img class="avatar" src="/${post.userAvatar}" alt="">`
                        html +=`<div class="pl-2 d-flex flex-column">`
                            html +=`<p class="avatar-name"> ${post.userName}</h5>`
                            html +=`<p class="p-0 post-date">${moment(post.createAt).fromNow()}</p>`
                        html += `</div>`
                    html +=`</div>`
                    html +=`<div class="card-body pt-0 pb-0">`
                        html +=`<blockquote class="blockquote mb-0 ">`
                            html +=`<p>${post.caption}</p>`
                            html += `<footer class="blockquote-footer">`
                                html +=` Someone famous in <cite title="Source Title">Source Title</cite>`
                            html +=`</footer>`
                        html +=`</blockquote>`
                    html +=`</div>`
                    html +=`<div class="card-body pt-2 text-muted">`
                        html +=`<div class="d-flex ">`
                            html +=`<div class="like-count"><i class="far fa-thumbs-up"></i> 890 </div>`
                            html +=`<div class="ml-auto text-right"> 20 Comments </div>`
                        html +=`</div>`
                    html +=`</div>`
                    html +=`<hr class="mt-0 mb-1 ">`
                    html +=`<div class="d-flex post-react justify-content-around ">`
                        html +=`<button class="btn btn-light col-md-4"> <i class="far fa-thumbs-up"></i> Like </button>`
                        html +=`<button  data-toggle="collapse" data-target="#luan${post._id}"  class="btn btn-light col-md-4"><i class="far fa-comment-alt"></i> Comment </button>`
                        html +=`<button class="btn btn-light col-md-4"><i class="far fa-share-square"></i> Share </button>`
                    html +=`</div>`
                html +=`</div>`

            
                html +=`<div class="collapse" id="luan${post._id}">`
                    html +=`<div class="card card-body mb-0" id="luan-comment">`
                        html +=`<div class="pl-2 flex-row">`
                            html +=`<img class="avatar-comment mt-1 mr-2" src="${post.userAvatar}" alt="">`
                            html +=`<input type="text" name="comment" class="form-control rounded  col-11 mt-1" placeholder="Viết bình luận ...">`
                            
                        html +=`</div>`
                        html +=`<div class="pl-2 d-flex flex-row  align-items-start mt-2">`
                            html +=`<img class="avatar-comment mt-2 " src="" >`
                            html +=`<div style=" display: inline-block; background-color : #e6e7eb" class="rounded p-2 pr-3 ml-2  mt-2"  > `
                                html +=`<span class="font-weight-bold" href="#">Luaan nguyen </span> <span class="float-right post-date">${moment(post.createAt).fromNow()}</span>`
                                html +=`<div >`
                                    html+= `Ay what the fuck lol My idea of 2D + 3D with blocky stuff and cursed high quality graphics is finally here! great job mate `
                                html+= `</div>`
                            html +=`</div>`
                        html +=`</div>`
                    html +=`</div>`
                html +=`</div>`
            }
        })

        $('#new-feed').append(html);
    }
</script>
